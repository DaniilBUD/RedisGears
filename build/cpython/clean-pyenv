#!/bin/bash

HERE="$(cd "$(dirname "${BASH_SOURCE[0]}")" >/dev/null 2>&1 && pwd)"
ROOT=$(cd $HERE/../..; pwd)

REDISLABS_DIR=/var/opt/redislabs

VERSION=$(NUMERIC=1 $ROOT/getver)
if [[ -z $VERSION ]]; then
	>&2 echo "Cannot determine module version. Aborting."
	exit 1
fi

if [[ -z $LOCAL ]]; then
	>&2 echo "LOCAL argument undefined. Aborting."
	exit 1
fi

# [[ -z $GLOBAL ]] && GLOBAL=$REDISLABS_DIR/lib/modules/python3
[[ -z $GLOBAL ]] && GLOBAL=$REDISLABS_DIR/modules/rg/$VERSION/deps/python3

[[ -e $LOCAL ]] && rm -rf $LOCAL
[[ -d $GLOBAL ]]; rm -rf $GLOBAL
find $(dirname $GLOBAL) -name $(basename $GLOBAL) -type l -delete

exit 0
