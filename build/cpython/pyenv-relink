#!/bin/bash

HERE="$(cd "$(dirname "${BASH_SOURCE[0]}")" >/dev/null 2>&1 && pwd)"
ROOT=$(cd $HERE/../..; pwd)

REDISLABS_DIR=/var/opt/redislabs

VERSION=$(NUMERIC=1 $ROOT/getver)
if [[ -z $VERSION ]]; then
	>&2 echo "Cannot determine module version. Aborting."
	exit 1
fi

if [[ -z $LOCAL ]]; then
	>&2 echo "LOCAL argument undefined. Aborting."
	exit 1
fi

[[ -z $GLOBAL ]] && GLOBAL=$REDISLABS_DIR/modules/rg/$VERSION/deps/python3

if [[ -L $GLOBAL ]]; then
	rm -f $GLOBAL
elif [[ -d $GLOBAL ]]; then
	echo "$GLOBAL is a directory."
	exit 1
fi
ln -s $(realpath $LOCAL) $GLOBAL

exit 0
